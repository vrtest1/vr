<!DOCTYPE html>
<html>
<head>
    <title>Snake Game</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="400" height="400"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // キャンバスの背景を描画
        ctx.fillStyle = "lightgray";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 衝突したときに表示する画像の読み込み
        let img = new Image();
        img.src = "collision.jpg";

        // Snakeオブジェクトの初期化
        let snake = {
            x: 10,
            y: 10,
            dx: 10,
            dy: 0,
            cells: [],
            maxCells: 4
        };

        // 食べ物の初期化
        let food = {
            x: Math.floor(Math.random() * 39) * 10,
            y: Math.floor(Math.random() * 39) * 10
        };

        // スコアの初期化
        let score = 0;

        // キー操作によるSnakeの移動
        document.addEventListener("keydown", function (e) {
            if (e.keyCode === 37 && snake.dx === 0) {
                snake.dx = -10;
                snake.dy = 0;
            } else if (e.keyCode === 38 && snake.dy === 0) {
                snake.dy = -10;
                snake.dx = 0;
            } else if (e.keyCode === 39 && snake.dx === 0) {
                snake.dx = 10;
                snake.dy = 0;
            } else if (e.keyCode === 40 && snake.dy === 0) {
                snake.dy = 10;
                snake.dx = 0;
            }
        });

        // Snakeの描画
        function drawSnake() {
            snake.x += snake.dx;
            snake.y += snake.dy;

            if (snake.x < 0) {
                snake.x = canvas.width - 10;
            } else if (snake.x >= canvas.width) {
                snake.x = 0;
            }

            if (snake.y < 0) {
                snake.y = canvas.height - 10;
            } else if (snake.y >= canvas.height) {
                snake.y = 0;
            }

            snake.cells.unshift({ x: snake.x, y: snake.y });

            if (snake.cells.length > snake.maxCells) {
                snake.cells.pop();
            }

            // Snakeの各セルを描画
            ctx.fillStyle = "green";
            snake.cells.forEach(function (cell, index) {
                ctx.fillRect(cell.x, cell.y, 10, 10);

                if (cell.x === food.x && cell.y === food.y) {
                    snake.maxCells++;
                    score++;
                    document.getElementById("score").innerHTML = "Score: " + score;
                    food.x = Math.floor(Math.random() * 39) * 10;
                    food.y = Math.floor(Math.random() * 39) * 10;
                }

                // Snakeが自分自身と衝突した場合
                for (let i = index + 1; i < snake.cells.length; i++) {
                    if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
                        gameOver();
                        snake.x = 10;
                        snake.y = 10;
                        snake.cells = [];
                        snake.maxCells = 4;
                        snake.dx = 10;
                        snake.dy = 0;
                        score = 0;
                        document.getElementById("score").innerHTML = "Score: " + score;
                        food.x = Math.floor(Math.random() * 39) * 10;
                        food.y = Math.floor(Math.random() * 39) * 10;
                    }
                }
            });
        }
        // 食べ物の描画
        function drawFood() {
            ctx.fillStyle = "red";
            ctx.fillRect(food.x, food.y, 10, 10);
        }

        function gameOver() {

            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            // ゲームを停止
            clearInterval(gameInterval);

            // 画像を表示
            let count = 0;
            let interval = setInterval(function () {
                count++;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                if (count === 60) {
                    clearInterval(interval);

                    // Snakeを初期化
                    snake.x = 10;
                    snake.y = 10;
                    snake.cells = [];
                    snake.maxCells = 4;
                    snake.dx = 10;
                    snake.dy = 0;

                    // スコアをリセット
                    score = 0;
                    document.getElementById("score").innerHTML = "Score: " + score;

                    // 食べ物を再配置
                    food.x = Math.floor(Math.random() * 39) * 10;
                    food.y = Math.floor(Math.random() * 39) * 10;

                    // ゲームを再開
                    gameInterval = setInterval(gameLoop, 1000 / 60);
                }
            }, 16.67);
        }


        // ゲームのループ
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawSnake();
            drawFood();
            setTimeout(gameLoop, 100);
        }

        gameLoop();
    </script>
    <p id="score">Score: 0</p>

</body>
</html>
